# 目录
[[#1.enforce]]
[[#2.selinux 策略(==sebool==) getsebool & setsebool| selinux策略]]




# 1.enforce | getenforce & setenforce
## 1.1配置文件
<span style="font-size:40px;background:yellow">/etc/selinux/config</span>
## 1.2命令
```shell
# 获取
getenforce

# 设置
setenforce [0 | 1] | [ permissive | enforcing] | disable

- enforcing  强制模式,只要selinux不允许,就无法执行
- permissive 警告模式,将该事件记录,依然允许执行
- disable    关闭selinux

# 彻底管理
# 在/etc/selinux/config
SELINUX=disable

# 模式切换重启,才永久生效
# 关闭到开启,重启时间长,原因更新文件标签数据库
```
## 2.安全上下文 | security context | chcon & restorecon

### 2.1规定文件的属性

| system_u  | object_r | httpd_sys_content_t |
| --------- | -------- | ------------------- |
| 用户        | 角色       | 类型                  |
|           |          |                     |
| policy:策略 |          |                     |
特点
1. cp 会重新生成
2. mv 不会~
3. 系统根据pam子系统中的/lib64/security/pam_selinux.so模块设定==登陆者==运行程序的安全上下文
4. rpm构建的包,根据rpm包的内记录生成安全上下文
5. 手工构建,根据policy中的规定来设置
安全上下文格式
<span style="font-size:40px;background:yellow">user:role:type</span>

user
- user_u         普通用户
- system_u      管理员
- unconfiend_u 非限制(没定义)
role
- object_r     文件与目录的role
- system_r    程序的role
- GID           用户的role，==同一个用户==可以是多个role，但==同一时间==内只能是一个role
### 2.2查看(==ls==)文件的安全上下文
```shell
# 查看
ls -Z
# 或
ls --context

# 改变
###########################
# 记得与“SELINUX”的特点结合 #
###########################
# chcon :  change context
# -t type
# -R recursion
chcon -t var_t  /etc/hosts
chcon --reference=/var/www/html/ /var/www/html/a.html

# /etc/selinux/targeted/context/files/file_context
restorecon 
```
### 2.3 chcon & restorecon 命令
#### 1.chcon
```shell
#  reference
chcon --reference=reference_file target_file
# -R recursion : 递归
# -v verbose   : 详细的 
```
#### 1.1案例
```shell
# 1.ftp共享给匿名用户
chcon -R -t public_content_t /var/ftp
# 2.ftp目录可以上传文件

chcon -t public_content_rw_t /var/ftp/incoming
# 3.允许http访问其家目录,该设定限仅于用户的家目录主页
setsebool -P httpd_enable_homedirs 1
chcon -R -t httpd_ssy_content_t ~user/public_html

# samba目录共享给其他用户
chcon -t samba_share_t /directory

# 共享rsync目录shi
chcon -t public_content_t /directories
```
# 2.selinux 策略(==sebool==) | getsebool & setsebool
<span style="font-size:40px;background:yellow">/selinux/booleans/</span>
## 命令
```shell
# bool(布尔值)
# on & off
# 获取
# -a all
getsebool -a

# 设置
# -p permanent
setsebool -P httpd_enable_homedirs=on

```
# 3.semanage
restorecon