# 任务
- [ ] 网站服务程序
- [ ] 配置服务文件参数
- [ ] Selinux安全子系统
- [x] 个人用户主页功能
- [x] 虚拟主机功能
- [ ] apache的访问控制

# 1.个人主页功能
## 1.1相关指令和命令
<span style="background:yellow;font-size:40px">/etc/httpd/conf.d/userdir.conf</span>
```xml
<IfModule mod_userdir.c>
	# UserDir disable
	UserDir [DirName]
</IfModule>
<Directory "/home/*/DirName">
	AllowOverride all
	Require all granted
</Directory>

# 相关模块 
# mod_userdir.c
# 相关安全策略 set & get sebool
# httpd_enable_homedir=on
```
> [!warning] 注意
> 一个用户只能使用一次=="UserDir"==
> curl访问时,需要加参数=="-L"==,原因==redirect==

| ==**UseDir**== \[ disable \| name ]<br>name 默认为"==public_html==" | 网站==数据==在用户==家目录==中保存数据的目录==名称== |
| ---------------------------------------------------------------- | -------------------------------- |
## 1.2在用户家目录创建"public_html"目录
```shell
mkdir /home/verthandi/public_html
# 让apache用户可以访问
chmod -R 755 /home/verthandi
# 重启apache服务
httpd -k graceful

# 访问
IP地址/~用户名(既linux中的用户,也是有"public_html"的用户) 
(无法访问;Selinux问题)
```
### 解决方案
修改=="http_enable_homedirs"==的布尔值
![[安全相关的#2.selinux 策略(==sebool==) getsebool & setsebool]]

# 2.basic认证
## 2.1认证文件
[[nginx和htpasswd和httpd命令#2.htpasswd命令 | htpasswd 命令]]
```shell
htpasswd -bc /etc/httpd/passwd linuxprobe:123
```
## 2.2编辑配置文件(==httpd.conf==)
四个参数
	1. AuthType    认证类型
	2. AuthUserFile 认证用户文件
	3. AuthName   提示信息
	4. Require user \<userName> 需要认证用户 
	5. ==\[to be continued] 不加"4"全部认证?==

```xml
<Directory "/home/*/public_html">
	...
	# 验证类型
	AuthType basic
	# 指定认证文件
	AuthUserFile "/etc/httpd/passwd"
	# 提示信息
	# privately 私人的
	AuthName "My privately website"

	# 访问网站时需要验证的用户名称
	# UserName 单个用户
	# 所有有效的用户
	Require [ user UserName1 [UserName2] | valid-user]
	# 不控制
	Require all granted
	
</Directory>
```
## 2.3相关配置
[[apache使用手册#4.虚拟主机 无";"结尾 | 虚拟主机]]

# 3.访问控制 (==httpd.conf==)
## 3.1基于IP地址或主机名 (granted & denied)
```xml
<Directory "/var/www/html/protected">
	# 黑名单
    Require all denied  # 默认拒绝所有访问
    Require ip 192.168.1  # 允许来自192.168.1.*网段的访问

	# 白名单
	<RequireAny>
		Require all granted
		Require not ip 192.168.94.1  # 只不允许192.168.94.1访问
	</equireAny>
    
</Directory>
```
### 相关标签 & IP地址与网段的写法
All & Any & None的区别

| 配置方式                             | 含义             | 是否必须   |
| -------------------------------- | -------------- | ------ |
| Require ip xxx.xxx.xxx.xxx/xx    | 指定一个IP范围       | ✅ 单独可用 |
| \<RequireAny>...\</RequireAny>   | 多个条件满足其一即可访问   | ❌ 不强制  |
| \<RequireAll>...\</RequireAll>   | 多个条件都必须满足才能访问  | ❌ 不强制  |
| \<RequireNone>...\</RequireNone> | 所有条件都不满足时才允许访问 | ❌ 不强制  |

| 写法                           | 含义                         |
| ---------------------------- | -------------------------- |
| Require ip 192.168.94.148    | 只允许这个 IP 访问（等同于 /32）       |
| Require ip 192.168.94.0/24   | 允许整个 192.168.94.0 ~ 255 网段 |
| Require ip 192.168.94.148/24 | 实际也代表整个 192.168.94.0/24 子网 |
## 3.2使用`.htaccess`文件
### 启用
```xml
<Directory "/var/www/html"> 
		AllowOverride All 
</Directory>

```
### .htaccess文件内容
```xml
Require all denied 
Require ip 192.168.1
```
## 3.3使用basic认证
### 相关配置
[[#2.basic认证]]
```xml
<Directory "/var/www/html/server">
# border : 边界
# Order  : 订单
	Order Allow,deny
	Allow from 192.168.10.20
</Directory>
```